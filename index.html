<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Deep Learning with mlr3 • mlr3torch</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Roboto-0.4.9/font.css" rel="stylesheet">
<link href="deps/JetBrains_Mono-0.4.9/font.css" rel="stylesheet">
<link href="deps/Roboto_Slab-0.4.9/font.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><script src="deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Deep Learning with mlr3">
<meta name="description" content="Deep Learning library that extends the mlr3 framework by building upon the torch package. It allows to conveniently build, train, and evaluate deep learning models without having to worry about low level details. Custom architectures can be created using the graph language defined in mlr3pipelines.">
<meta property="og:description" content="Deep Learning library that extends the mlr3 framework by building upon the torch package. It allows to conveniently build, train, and evaluate deep learning models without having to worry about low level details. Custom architectures can be created using the graph language defined in mlr3pipelines.">
<meta property="og:image" content="https://mlr3torch.mlr-org.com/logo.svg">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">mlr3torch</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html"><span class="fa fa-file-alt"></span> Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="articles/get_started.html">Get Started</a></li>
    <li><a class="dropdown-item" href="articles/pipeop_torch.html">Defining an Architecture</a></li>
    <li><a class="dropdown-item" href="articles/callbacks.html">Callbacks</a></li>
    <li><a class="dropdown-item" href="articles/lazy_tensor.html">Non-Tabular Data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Internals</h6></li>
    <li><a class="dropdown-item" href="articles/internals_pipeop_torch.html">Networks as Graphs</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-overview" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Overview</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-overview">
<li><a class="dropdown-item" href="articles/task_list.html">Tasks</a></li>
    <li><a class="dropdown-item" href="articles/preprocessing_list.html">Preprocessing &amp; Augmentation</a></li>
    <li><a class="dropdown-item" href="articles/optimizer_list.html">Optimizers</a></li>
    <li><a class="dropdown-item" href="articles/loss_list.html">Losses</a></li>
    <li><a class="dropdown-item" href="articles/callback_list.html">Callbacks</a></li>
    <li><a class="dropdown-item" href="articles/learner_list.html">Learners</a></li>
    <li><a class="dropdown-item" href="articles/layer_list.html">Network Layers</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://mlr3book.mlr-org.com"><span class="fa fa-link"></span> mlr3book</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mlr-org/mlr3torch"><span class="fa fa-github"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite/"><span class="fa fa-comments"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://stackoverflow.com/questions/tagged/mlr3"><span class="fa fab fa-stack-overflow"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mlr-org.com/"><span class="fa fa-rss"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.svg" class="logo" alt=""><h1 id="mlr3torch-">mlr3torch 
<a class="anchor" aria-label="anchor" href="#mlr3torch-"></a>
</h1>
</div>
<p>Package website: <a href="https://mlr3torch.mlr-org.com/">release</a> | <a href="https://mlr3torch.mlr-org.com/dev/">dev</a></p>
<p>Deep Learning with torch and mlr3.</p>
<!-- badges: start -->

<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install from CRAN</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"mlr3torch"</span><span class="op">)</span></span>
<span><span class="co"># Install the development version from GitHub:</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"mlr-org/mlr3torch"</span><span class="op">)</span></span></code></pre></div>
<p>Afterwards, you also need to run the command below:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://torch.mlverse.org/docs/reference/install_torch.html" class="external-link">install_torch</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>More information about installing <code>torch</code> can be found <a href="https://torch.mlverse.org/docs/articles/installation.html" class="external-link">here</a>.</p>
</div>
<div class="section level2">
<h2 id="what-is-mlr3torch">What is mlr3torch?<a class="anchor" aria-label="anchor" href="#what-is-mlr3torch"></a>
</h2>
<p><code>mlr3torch</code> is a deep learning framework for the <a href="https://mlr-org.com" class="external-link"><code>mlr3</code></a> ecosystem built on top of <a href="https://torch.mlverse.org/" class="external-link"><code>torch</code></a>. It allows to easily build, train and evaluate deep learning models in a few lines of codes, without needing to worry about low-level details. Off-the-shelf learners are readily available, but custom architectures can be defined by connecting <code>PipeOpTorch</code> operators in an <code><a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html" class="external-link">mlr3pipelines::Graph</a></code>.</p>
<p>Using predefined learners such as a simple multi layer perceptron (MLP) works just like any other mlr3 <code>Learner</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3torch.mlr-org.com/">mlr3torch</a></span><span class="op">)</span></span>
<span><span class="va">learner_mlp</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"classif.mlp"</span>,</span>
<span>  <span class="co"># defining network parameters</span></span>
<span>  activation     <span class="op">=</span> <span class="va">nn_relu</span>,</span>
<span>  neurons        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>  <span class="co"># training parameters</span></span>
<span>  batch_size     <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  epochs         <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  device         <span class="op">=</span> <span class="st">"cpu"</span>,</span>
<span>  <span class="co"># Proportion of data to use for validation</span></span>
<span>  validate <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  <span class="co"># Defining the optimizer, loss, and callbacks</span></span>
<span>  optimizer      <span class="op">=</span> <span class="fu"><a href="reference/t_opt.html">t_opt</a></span><span class="op">(</span><span class="st">"adam"</span>, lr <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  loss           <span class="op">=</span> <span class="fu"><a href="reference/t_loss.html">t_loss</a></span><span class="op">(</span><span class="st">"cross_entropy"</span><span class="op">)</span>,</span>
<span>  callbacks      <span class="op">=</span> <span class="fu"><a href="reference/t_clbk.html">t_clbk</a></span><span class="op">(</span><span class="st">"history"</span><span class="op">)</span>, <span class="co"># this saves the history in the learner</span></span>
<span>  <span class="co"># Measures to track</span></span>
<span>  measures_valid <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">msrs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"classif.logloss"</span>, <span class="st">"classif.ce"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  measures_train <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">msrs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"classif.acc"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="co"># predict type (required by logloss)</span></span>
<span>  predict_type <span class="op">=</span> <span class="st">"prob"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Below, we train this learner on the sonar example task:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">learner_mlp</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">tsk</a></span><span class="op">(</span><span class="st">"sonar"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next, we construct the same architecture using <code>PipeOpTorch</code> objects. The first pipeop – a <code>PipeOpTorchIngress</code> – defines the entrypoint of the network. All subsequent pipeops define the neural network layers.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">architecture</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"torch_ingress_num"</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_linear"</span>, out_features <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_relu"</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_head"</span><span class="op">)</span></span></code></pre></div>
<p>To turn this into a learner, we configure the loss, optimizer, callbacks as well as the training arguments.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph_mlp</span> <span class="op">=</span> <span class="va">architecture</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"torch_loss"</span>, loss <span class="op">=</span> <span class="fu"><a href="reference/t_loss.html">t_loss</a></span><span class="op">(</span><span class="st">"cross_entropy"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"torch_optimizer"</span>, optimizer <span class="op">=</span> <span class="fu"><a href="reference/t_opt.html">t_opt</a></span><span class="op">(</span><span class="st">"adam"</span>, lr <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"torch_callbacks"</span>, callbacks <span class="op">=</span> <span class="fu"><a href="reference/t_clbk.html">t_clbk</a></span><span class="op">(</span><span class="st">"history"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"torch_model_classif"</span>,</span>
<span>    batch_size <span class="op">=</span> <span class="fl">16</span>, epochs <span class="op">=</span> <span class="fl">50</span>, device <span class="op">=</span> <span class="st">"cpu"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">graph_lrn</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_learner.html" class="external-link">as_learner</a></span><span class="op">(</span><span class="va">graph_mlp</span><span class="op">)</span></span></code></pre></div>
<p>To work with generic tensors, the <code>lazy_tensor</code> type can be used. It wraps a <code><a href="https://torch.mlverse.org/docs/reference/dataset.html" class="external-link">torch::dataset</a></code>, but allows to preprocess the data (lazily) using <code>PipeOp</code> objects. Below, we flatten the MNIST task, so we can then train a multi-layer perceptron on it. Note that this does <em>not</em> transform the data in-memory, but is only applied when the data is actually loaded.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the predefined mnist task</span></span>
<span><span class="va">mnist</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">tsk</a></span><span class="op">(</span><span class="st">"mnist"</span><span class="op">)</span></span>
<span><span class="va">mnist</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span><span class="fl">3L</span><span class="op">)</span></span>
<span><span class="co">#&gt;     label           image</span></span>
<span><span class="co">#&gt;    &lt;fctr&gt;   &lt;lazy_tensor&gt;</span></span>
<span><span class="co">#&gt; 1:      5 &lt;tnsr[1x28x28]&gt;</span></span>
<span><span class="co">#&gt; 2:      0 &lt;tnsr[1x28x28]&gt;</span></span>
<span><span class="co">#&gt; 3:      4 &lt;tnsr[1x28x28]&gt;</span></span>
<span></span>
<span><span class="co"># Flatten the images</span></span>
<span><span class="va">flattener</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"trafo_reshape"</span>, shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">28</span> <span class="op">*</span> <span class="fl">28</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mnist_flat</span> <span class="op">=</span> <span class="va">flattener</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">mnist</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">mnist_flat</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span><span class="fl">3L</span><span class="op">)</span></span>
<span><span class="co">#&gt;     label         image</span></span>
<span><span class="co">#&gt;    &lt;fctr&gt; &lt;lazy_tensor&gt;</span></span>
<span><span class="co">#&gt; 1:      5   &lt;tnsr[784]&gt;</span></span>
<span><span class="co">#&gt; 2:      0   &lt;tnsr[784]&gt;</span></span>
<span><span class="co">#&gt; 3:      4   &lt;tnsr[784]&gt;</span></span></code></pre></div>
<p>To actually access the tensors, we can call <code><a href="reference/materialize.html">materialize()</a></code>. We only show a slice of the resulting tensor for readability:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/materialize.html">materialize</a></span><span class="op">(</span></span>
<span>  <span class="va">mnist_flat</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, cols <span class="op">=</span> <span class="st">"image"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  rbind <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt;  0  0  0  0</span></span>
<span><span class="co">#&gt;  0  0  0  0</span></span>
<span><span class="co">#&gt; [ CPUFloatType{2,4} ]</span></span></code></pre></div>
<p>Below, we define a more complex architecture that has one single input which is a <code>lazy_tensor</code>. For that, we first define a single residual block:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">layer</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nop"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_linear"</span>, out_features <span class="op">=</span> <span class="fl">50L</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_dropout"</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_relu"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_merge_sum"</span><span class="op">)</span></span></code></pre></div>
<p>Next, we create a neural network that takes as input a <code>lazy_tensor</code> (<code>po("torch_ingress_ltnsr")</code>). It first applies a linear layer and then repeats the above layer using the special <code>PipeOpTorchBlock</code>, followed by the network’s head. After that, we configure the loss, optimizer and the training parameters. Note that <code>po("nn_linear_0")</code> is equivalent to <code>po("nn_linear", id = "nn_linear_0")</code> and we need this here to avoid ID clashes with the linear layer from <code>po("nn_block")</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">deep_network</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"torch_ingress_ltnsr"</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_linear"</span>, out_features <span class="op">=</span> <span class="fl">50L</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_block"</span>, <span class="va">layer</span>, n_blocks <span class="op">=</span> <span class="fl">5L</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_head"</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"torch_loss"</span>, loss <span class="op">=</span> <span class="fu"><a href="reference/t_loss.html">t_loss</a></span><span class="op">(</span><span class="st">"cross_entropy"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"torch_optimizer"</span>, optimizer <span class="op">=</span> <span class="fu"><a href="reference/t_opt.html">t_opt</a></span><span class="op">(</span><span class="st">"adam"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"torch_model_classif"</span>,</span>
<span>    epochs <span class="op">=</span> <span class="fl">100L</span>, batch_size <span class="op">=</span> <span class="fl">32</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Next, we prepend the preprocessing step that flattens the images so we can directly apply this learner to the unflattened MNIST task.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">deep_learner</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_learner.html" class="external-link">as_learner</a></span><span class="op">(</span></span>
<span>  <span class="va">flattener</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span> <span class="va">deep_network</span></span>
<span><span class="op">)</span></span>
<span><span class="va">deep_learner</span><span class="op">$</span><span class="va">id</span> <span class="op">=</span> <span class="st">"deep_network"</span></span></code></pre></div>
<p>In order to keep track of the performance during training, we use 20% of the data and evaluate it using classification accuracy.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">set_validate</a></span><span class="op">(</span><span class="va">deep_learner</span>, <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">deep_learner</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="fu">set_values</span><span class="op">(</span></span>
<span>  torch_model_classif.measures_valid <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">msr</a></span><span class="op">(</span><span class="st">"classif.acc"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>All that is left is to train the learner:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">deep_learner</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">mnist</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="feature-overview">Feature Overview<a class="anchor" aria-label="anchor" href="#feature-overview"></a>
</h2>
<ul>
<li>Off-the-shelf architectures are readily available as <code><a href="https://mlr3.mlr-org.com/reference/Learner.html" class="external-link">mlr3::Learner</a></code>s.</li>
<li>Currently, supervised regression and classification is supported.</li>
<li>Custom learners can be defined using the <code>Graph</code> language from <code>mlr3pipelines</code>.</li>
<li>The package supports tabular data, as well as generic tensors via the <code>lazy_tensor</code> type.</li>
<li>Multi-modal data can be handled conveniently, as <code>lazy_tensor</code> objects can be stored alongside tabular data.</li>
<li>It is possible to customize the training process via (predefined or custom) callbacks.</li>
<li>The package is fully integrated into the <code>mlr3</code> ecosystem.</li>
<li>Neural network architectures, as well as their hyperparameters can be easily tuned via <code>mlr3tuning</code> and friends.</li>
</ul>
</div>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h2>
<ul>
<li>Start by reading one of the vignettes on the package website!</li>
<li>There is a <a href="https://mlr-org.github.io/mlr3torch-course/" class="external-link">course on <code>(mlr3)torch</code></a>.</li>
<li>You can check out our <a href="https://sebffischer.github.io/mlr3torch-UseR-2024/#/" class="external-link">presentation from UseR 2024</a>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="contributing">Contributing:<a class="anchor" aria-label="anchor" href="#contributing"></a>
</h2>
<ul>
<li>To run the tests one needs to set the environment variable <code>TEST_TORCH = 1</code>, e.g. by adding it to <code>.Renviron</code>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h2>
<ul>
<li>Without the great R package <code>torch</code> none of this would have been possible.</li>
<li>The names for the callback stages are taken from <a href="https://mlverse.github.io/luz/" class="external-link">luz</a>, another high-level deep learning framework for R <code>torch</code>.</li>
<li>Building neural networks using <code>PipeOpTorch</code> operators is inspired by <a href="https://keras.io/" class="external-link">keras</a>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="bugs-questions-feedback">Bugs, Questions, Feedback<a class="anchor" aria-label="anchor" href="#bugs-questions-feedback"></a>
</h2>
<p><em>mlr3torch</em> is a free and open source software project that encourages participation and feedback. If you have any issues, questions, suggestions or feedback, please do not hesitate to open an “issue” about it on the GitHub page!</p>
<p>In case of problems / bugs, it is often helpful if you provide a “minimum working example” that showcases the behaviour (but don’t worry about this if the bug is obvious).</p>
<p>Please understand that the resources of the project are limited: response may sometimes be delayed by a few days, and some feature suggestions may be rejected if they are deemed too tangential to the vision behind the project.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=mlr3torch" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/mlr-org/mlr3torch/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/mlr-org/mlr3torch/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>LGPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing mlr3torch</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Sebastian Fischer <br><small class="roles"> Maintainer, author </small> <a href="https://orcid.org/0000-0002-9609-3197" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Martin Binder <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Fischer, Martin Binder.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
