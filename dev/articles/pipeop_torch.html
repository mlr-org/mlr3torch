<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Defining an Architecture • mlr3torch</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.9/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Defining an Architecture">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mlr3torch</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.2-9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-alt"></span> Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/callbacks.html">Custom Callbacks</a></li>
    <li><a class="dropdown-item" href="../articles/get_started.html">Get Started</a></li>
    <li><a class="dropdown-item" href="../articles/internals_pipeop_torch.html">Internals</a></li>
    <li><a class="dropdown-item" href="../articles/lazy_tensor.html">Lazy Tensor</a></li>
    <li><a class="dropdown-item" href="../articles/pipeop_torch.html">Defining an Architecture</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://mlr3book.mlr-org.com"><span class="fa fa-link"></span> mlr3book</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mlr-org/mlr3torch"><span class="fa fa-github"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite/"><span class="fa fa-comments"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://stackoverflow.com/questions/tagged/mlr3"><span class="fa fab fa-stack-overflow"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mlr-org.com/"><span class="fa fa-rss"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="pipeop_torch_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="pipeop_torch_files/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="pipeop_torch_files/vis-9.1.0/vis-network.min.js"></script><script src="pipeop_torch_files/visNetwork-binding-2.1.2/visNetwork.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Defining an Architecture</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mlr-org/mlr3torch/blob/main/vignettes/articles/pipeop_torch.Rmd" class="external-link"><code>vignettes/articles/pipeop_torch.Rmd</code></a></small>
      <div class="d-none name"><code>pipeop_torch.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we will show how to build neural network
architectures as <code>mlr3pipelines::Graphs</code>s. We will create a
simple CNN for the tiny-imagenet task, which is a subst of well-known
Imagenet benchmark.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3torch.mlr-org.com/">mlr3torch</a></span><span class="op">)</span></span>
<span><span class="va">imagenet</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">tsk</a></span><span class="op">(</span><span class="st">"tiny_imagenet"</span><span class="op">)</span></span>
<span><span class="va">imagenet</span></span>
<span><span class="co">#&gt; &lt;TaskClassif:tiny_imagenet&gt; (110000 x 2): ImageNet Subset</span></span>
<span><span class="co">#&gt; * Target: class</span></span>
<span><span class="co">#&gt; * Properties: multiclass</span></span>
<span><span class="co">#&gt; * Features (1):</span></span>
<span><span class="co">#&gt;   - lt (1): image</span></span></code></pre></div>
<p>The central ingredients for creating such graphs are
<code>PipeOpTorch</code> operators.</p>
<p>To mark the entry-point of the neural network, we use a
<code>PipeOpTorchIngress</code>, for which three different flavors
exist:</p>
<ul>
<li>
<code>po("torch_ingress_num")</code> for numeric data</li>
<li>
<code>po("torch_ingress_categ")</code> for categorical columns</li>
<li>
<code>po("torch_ingress_ltnsr")</code> for
<code>lazy_tensor</code>s</li>
</ul>
<p>Because the imagenet task contains only one feature of type
<code>lazy_tensor</code>, we go for the last option:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">architecture</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"torch_ingress_ltnsr"</span><span class="op">)</span></span></code></pre></div>
<p>We now define a relatively simple convolutional neural network. Note
that in the code below <code>po("nn_relu_1")</code> is equivalent to
<code>po("nn_relu", id = "nn_linear_1")</code>. This is needed, because
<code><a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html" class="external-link">mlr3pipelines::Graph</a></code>s require that each <code>PipeOp</code>
has a unique ID.</p>
<p>What we can further notice is that we don’t have to specify the input
dimension for the convolutional layers, which are inferred from the task
during <code>$train()</code>ing. This means that our
<code>Learner</code> can be applied to tasks with different image sizes,
each time building up the correct network structure.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">architecture</span> <span class="op">=</span> <span class="va">architecture</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_conv2d_1"</span>, out_channels <span class="op">=</span> <span class="fl">64</span>, kernel_size <span class="op">=</span> <span class="fl">11</span>, stride <span class="op">=</span> <span class="fl">4</span>, padding <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_relu_1"</span>, inplace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_max_pool2d_1"</span>, kernel_size <span class="op">=</span> <span class="fl">3</span>, stride <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_conv2d_2"</span>, out_channels <span class="op">=</span> <span class="fl">192</span>, kernel_size <span class="op">=</span> <span class="fl">5</span>, padding <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_relu_2"</span>, inplace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_max_pool2d_2"</span>, kernel_size <span class="op">=</span> <span class="fl">3</span>, stride <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>We can now continue with specifying the classification part of the
network, which is a dense network that repeats a layer twice:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dense_layer</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_dropout"</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_linear"</span>, out_features <span class="op">=</span> <span class="fl">4096</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_relu_6"</span><span class="op">)</span></span></code></pre></div>
<p>In order to repeat a segment from a network multiple times, we can
use <code>po("nn_block")</code>, which we here repeat twice. Then, we
follow with the output head of the network, where we don’t have to
specify the number of classes, as they can also be inferred from the
task</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classifier</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_block"</span>, <span class="va">dense_layer</span>, n_blocks <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_head"</span><span class="op">)</span></span></code></pre></div>
<p>Next, we can combine the convolutional part with the dense head:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">architecture</span> <span class="op">=</span> <span class="va">architecture</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"nn_flatten"</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="va">classifier</span></span></code></pre></div>
<p>Below, we display the network:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">architecture</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>html <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:50%;height:400px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"nodes":{"id":["torch_ingress_ltnsr","nn_conv2d_1","nn_relu_1","nn_max_pool2d_1","nn_conv2d_2","nn_relu_2","nn_max_pool2d_2","nn_block","nn_flatten","<INPUT>","nn_head","<OUTPUT>"],"label":["torch_ingress_ltnsr","nn_conv2d_1","nn_relu_1","nn_max_pool2d_1","nn_conv2d_2","nn_relu_2","nn_max_pool2d_2","nn_block","nn_flatten","<INPUT>","nn_head","<OUTPUT>"],"shape":["box","box","box","box","box","box","box","box","box","database","box","ellipse"],"color":["lightblue","lightblue","lightblue","lightblue","lightblue","lightblue","lightblue","lightblue","lightblue","rgba(0,204,102,0.2)","lightblue","rgba(255,51,51,0.2)"],"value":[1,1,1,1,1,1,1,1,1,0.8,1,0.8],"title":["<p>PipeOp: <b>torch_ingress_ltnsr<\/b> (not trained)<br>values: <b>list()<\/b><br>Input channels <b>name [train type, predict type]<\/b>:<br>  input [Task,Task]<br>Output channels <b>name [train type, predict type]<\/b>:<br>  output [ModelDescriptor,Task]<\/p>","<p>PipeOp: <b>nn_conv2d_1<\/b> (not trained)<br>values: <b>out_channels=64, kernel_size=11, stride=4, padding=2<\/b><br>Input channels <b>name [train type, predict type]<\/b>:<br>  input [ModelDescriptor,Task]<br>Output channels <b>name [train type, predict type]<\/b>:<br>  output [ModelDescriptor,Task]<\/p>","<p>PipeOp: <b>nn_relu_1<\/b> (not trained)<br>values: <b>inplace=TRUE<\/b><br>Input channels <b>name [train type, predict type]<\/b>:<br>  input [ModelDescriptor,Task]<br>Output channels <b>name [train type, predict type]<\/b>:<br>  output [ModelDescriptor,Task]<\/p>","<p>PipeOp: <b>nn_max_pool2d_1<\/b> (not trained)<br>values: <b>kernel_size=3, stride=2<\/b><br>Input channels <b>name [train type, predict type]<\/b>:<br>  input [ModelDescriptor,Task]<br>Output channels <b>name [train type, predict type]<\/b>:<br>  output [ModelDescriptor,Task]<\/p>","<p>PipeOp: <b>nn_conv2d_2<\/b> (not trained)<br>values: <b>out_channels=192, kernel_size=5, padding=2<\/b><br>Input channels <b>name [train type, predict type]<\/b>:<br>  input [ModelDescriptor,Task]<br>Output channels <b>name [train type, predict type]<\/b>:<br>  output [ModelDescriptor,Task]<\/p>","<p>PipeOp: <b>nn_relu_2<\/b> (not trained)<br>values: <b>inplace=TRUE<\/b><br>Input channels <b>name [train type, predict type]<\/b>:<br>  input [ModelDescriptor,Task]<br>Output channels <b>name [train type, predict type]<\/b>:<br>  output [ModelDescriptor,Task]<\/p>","<p>PipeOp: <b>nn_max_pool2d_2<\/b> (not trained)<br>values: <b>kernel_size=3, stride=2<\/b><br>Input channels <b>name [train type, predict type]<\/b>:<br>  input [ModelDescriptor,Task]<br>Output channels <b>name [train type, predict type]<\/b>:<br>  output [ModelDescriptor,Task]<\/p>","<p>PipeOp: <b>nn_block<\/b> (not trained)<br>values: <b>n_blocks=2, nn_linear.out_features=4096<\/b><br>Input channels <b>name [train type, predict type]<\/b>:<br>  nn_dropout.input [ModelDescriptor,Task]<br>Output channels <b>name [train type, predict type]<\/b>:<br>  nn_relu_6.output [ModelDescriptor,Task]<\/p>","<p>PipeOp: <b>nn_flatten<\/b> (not trained)<br>values: <b>list()<\/b><br>Input channels <b>name [train type, predict type]<\/b>:<br>  input [ModelDescriptor,Task]<br>Output channels <b>name [train type, predict type]<\/b>:<br>  output [ModelDescriptor,Task]<\/p>","<p>Input:<br>Name: torch_ingress_ltnsr.input<br>Train: Task<br>Predict: Task<\/p>","<p>PipeOp: <b>nn_head<\/b> (not trained)<br>values: <b>list()<\/b><br>Input channels <b>name [train type, predict type]<\/b>:<br>  input [ModelDescriptor,Task]<br>Output channels <b>name [train type, predict type]<\/b>:<br>  output [ModelDescriptor,Task]<\/p>","<p>Output:<br>Name: nn_head.output<br>Train: ModelDescriptor<br>Predict: Task<\/p>"],"x":[0,0,0,0,0,0,0,0,0,0,0,0],"y":[-0.8181818181818181,-0.6363636363636364,-0.4545454545454546,-0.2727272727272727,-0.09090909090909094,0.09090909090909083,0.2727272727272727,0.6363636363636365,0.4545454545454546,-1,0.8181818181818181,1]},"edges":{"from":["torch_ingress_ltnsr","nn_conv2d_1","nn_relu_1","nn_max_pool2d_1","nn_conv2d_2","nn_relu_2","nn_max_pool2d_2","nn_block","nn_flatten","<INPUT>","nn_head"],"to":["nn_conv2d_1","nn_relu_1","nn_max_pool2d_1","nn_conv2d_2","nn_relu_2","nn_max_pool2d_2","nn_flatten","nn_head","nn_block","torch_ingress_ltnsr","<OUTPUT>"],"color":["lightblue","lightblue","lightblue","lightblue","lightblue","lightblue","lightblue","lightblue","lightblue","lightblue","lightblue"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"arrows":"to","smooth":{"enabled":false,"forceDirection":"vertical"}},"physics":{"stabilization":false}},"groups":null,"width":"50%","height":"400px","idselection":{"enabled":false},"byselection":{"enabled":false},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","igraphlayout":{"type":"full"}},"evals":[],"jsHooks":[]}</script><p>To turn this network architecture into an <code><a href="https://mlr3.mlr-org.com/reference/Learner.html" class="external-link">mlr3::Learner</a></code>
what is left to do is to configure the loss, optimizer, callbacks, and
training arguments, which we do now: We use the standard cross-entropy
loss, SGD as the optimizer and checkpoint our model every 20 epochs.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">checkpoint</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">architecture</span> <span class="op">=</span> <span class="va">architecture</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"torch_loss"</span>, <span class="fu"><a href="../reference/t_loss.html">t_loss</a></span><span class="op">(</span><span class="st">"cross_entropy"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"torch_optimizer"</span>, <span class="fu"><a href="../reference/t_opt.html">t_opt</a></span><span class="op">(</span><span class="st">"sgd"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"torch_callbacks"</span>, </span>
<span>    <span class="fu"><a href="../reference/t_clbk.html">t_clbk</a></span><span class="op">(</span><span class="st">"checkpoint"</span>, freq <span class="op">=</span> <span class="fl">20</span>, path <span class="op">=</span> <span class="va">checkpoint</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html" class="external-link">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="external-link">po</a></span><span class="op">(</span><span class="st">"torch_model_classif"</span>,</span>
<span>    batch_size <span class="op">=</span> <span class="fl">32</span>, epochs <span class="op">=</span> <span class="fl">100L</span>, device <span class="op">=</span> <span class="st">"cuda"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cnn</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_learner.html" class="external-link">as_learner</a></span><span class="op">(</span><span class="va">architecture</span><span class="op">)</span></span>
<span><span class="va">cnn</span><span class="op">$</span><span class="va">id</span> <span class="op">=</span> <span class="st">"cnn"</span></span></code></pre></div>
<p>This created <code>Learner</code> now exposes all configuration
options of the individual <code>PipeOp</code>s in its
<code>$param_set</code>, from which we show only a subset for
readability:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">cnn</span><span class="op">$</span><span class="va">param_set</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">32</span>, <span class="fl">34</span>, <span class="fl">42</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="co">#&gt;                             id    class lower upper</span></span>
<span><span class="co">#&gt;                         &lt;char&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:           nn_block.n_blocks ParamInt     1   Inf</span></span>
<span><span class="co">#&gt; 2: nn_block.nn_dropout.inplace ParamLgl    NA    NA</span></span>
<span><span class="co">#&gt; 3:          torch_optimizer.lr ParamDbl     0   Inf</span></span></code></pre></div>
<p>We can still change them, or if we wanted to, even tune them! Below,
we increase the number of blocks and latent dimension of the dense part,
as well as change the learning rate of the SGD optimizer.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cnn</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="fu">set_values</span><span class="op">(</span></span>
<span>  nn_block.n_blocks <span class="op">=</span> <span class="fl">4L</span>,</span>
<span>  nn_block.nn_linear.out_features <span class="op">=</span> <span class="fl">4096</span> <span class="op">*</span> <span class="fl">2</span>,</span>
<span>  torch_optimizer.lr <span class="op">=</span> <span class="fl">0.2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Finally, we train the learner on the task:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cnn</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">imagenet</span><span class="op">)</span></span></code></pre></div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Fischer, Martin Binder.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
